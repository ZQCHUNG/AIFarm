# AIFarm — Claude Buddy V3.0

透明 Electron 桌面夥伴，監控你的 Claude Code 工作階段，將它們化為**星露谷風格的像素農場模擬**。寫越多 code，世界越繁榮。

![AIFarm Screenshot](Images/screenshot-farm.png)

## 運作原理

Claude Buddy 透過 JSONL 日誌檔案監控你的 Claude Code 工作階段。每個程式碼事件（工具呼叫、思考、文字輸出）都會產生**能量**驅動你的農場：

- 作物自動生長並收成
- 動物隨里程碑解鎖，在牧場漫步
- 建築物隨進度出現在村莊區
- 你的夥伴（每個工作階段一個）自主在農場工作
- **你**控制玩家角色探索、賣貨、購物

## 功能一覽

### 玩家角色與控制
- WASD / 方向鍵移動，帶速度 + 摩擦力物理
- 金色帽 T「領主」角色，與 NPC 夥伴視覺區分（頭頂金色箭頭指示）
- 滑動瓷磚碰撞（4 角碰撞箱）
- 平滑 lerp 鏡頭跟隨（0.08）

### 資源經濟
- **多資源系統**：WOOD、STONE、GOLD 及各作物資源
- **出貨箱**：走近按 [E] 賣出作物/資源換取 GOLD
- **雜貨店**：走到工具小屋按 [E] 開啟商店
  - 購買種子（草莓、小麥）、加速藥水、田地擴張許可證
- 資源 HUD 列，帶 emoji 圖示與數值變化彈跳動畫
- 收穫時資源 icon 以弧形軌跡飛向 HUD

### 歷史工作階段 NPC
- 過去的 Claude Code 工作階段變成 NPC 角色在村莊漫步
- 依工作階段時長分進化等級：
  - **新手** (< 30 分鐘)：明亮顏色、快速走路、活潑
  - **老手** (30 分鐘 - 2 小時)：戴眼鏡、中等速度
  - **賢者** (> 2 小時)：白灰色、有鬍子、金色光暈、緩慢步伐
- 點擊 NPC 查看專案名稱、工作時長、日期
- 最多顯示 8 個 NPC，依等級多樣性篩選

### 等距農場引擎
- 3/4 俯視視角，32x32 瓷磚網格（20x18 地圖）
- 平滑鏡頭平移、縮放（滾輪）及閒置自動巡遊
- 多層 Z 排序渲染：地形、實體、粒子、天氣、HUD
- Event Bus 架構實現模組解耦

### 作物系統（6+ 種類）
紅蘿蔔、向日葵、西瓜、番茄、玉米、南瓜 — 各有 5 個生長階段。12 塊農田隨能量里程碑逐步解鎖。商店可購買新種子。

### 動物系統（6 種類）
雞、牛、豬、羊、貓、狗 — 在牧場漫步，帶閒置動畫與狀態機 AI（漫步、休息、反應）。

### 建築系統（7 棟建築）
水井、穀倉、風車、市場、鐘塔、市政廳、雕像 — 隨里程碑出現在村莊列。

### 夥伴 AI 行為
每個 Claude Code 工作階段生成一個夥伴角色，自主：
- 從工具小屋拿取工具
- 澆水與照顧動物
- 收穫成熟作物（帶粒子特效與浮動獎勵文字）
- 靠近其他夥伴時社交互動（emoji 聊天氣泡）

### 天氣與日夜循環
- 四季各有獨特天空漸層、地面色調與粒子效果
- 完整日夜循環：黎明、白天、黃昏、夜晚，平滑過渡
- 夜晚閃爍星星、農場小路溫暖路燈光暈

### 互動元素
- **佈告欄**：點擊開啟每日摘要（使用統計、農場進度、活動日誌）
- **金色小鳥**：稀有隨機訪客出現在圍欄上 — 點擊獲得額外閃光
- **紀念碑**：10,000 能量解鎖，帶脈動水晶與總 token 顯示
- **截圖模式**：HUD 相機按鈕將農場截圖為 PNG 含浮水印

### 火車系統
新夥伴搭火車抵達車站。成就解鎖觸發金色火車事件。

### 威望 / 世代系統
重置並擴張農場，跨世代長期進展。

### 氛圍系統
根據寫 code 模式即時偵測情緒（高效、專注、創意、挫折、平靜、閒置），影響天氣與動物行為。

## 操作方式

| 輸入 | 動作 |
|------|------|
| WASD / 方向鍵 | 移動玩家角色 |
| 滑鼠滾輪 | 縮放 |
| E | 互動（在工具小屋購物 / 在出貨箱賣貨） |
| W/S + Enter | 瀏覽商店選單 |
| Escape | 關閉商店 |
| 點擊 NPC | 查看工作階段資訊 |
| 點擊佈告欄 | 開啟每日摘要 |
| 點擊相機按鈕 | 儲存農場截圖 |
| Ctrl+Shift+I | 切換等距/經典視角 |
| Ctrl+Shift+D | 切換 debug 平移 |

## 能量里程碑

| 能量 | 里程碑 | 解鎖內容 |
|------|--------|----------|
| 50 | 第一顆種子 | 紅蘿蔔、農田 1-3 |
| 150 | 園丁 | 向日葵 |
| 300 | 綠手指 | 西瓜 |
| 500 | 農夫 | 番茄、農田 4-6、雞 |
| 800 | 牧場主 | 玉米、牛 |
| 1,200 | 拓荒者 | 南瓜、豬、水井 |
| 1,800 | 村民 | 羊、穀倉 |
| 2,500 | 城鎮建造者 | 貓、風車 |
| 3,500 | 繁榮 | 狗、市場 |
| 5,000 | 興盛 | 鐘塔、農田 7-9 |
| 7,500 | 大都會 | 市政廳 |
| 10,000 | 傳奇 | 雕像、紀念碑 |

## 開發進度

### 已完成

| Sprint | 名稱 | 功能 |
|--------|------|------|
| 11 | 工具小屋與農場日誌 | 工具小屋建築、農場活動日誌、角色配件 |
| 12 | 社交生活 | 夥伴社交氣泡、紀念碑系統、金色小鳥事件 |
| 13 | 氣氛營造 | 日夜循環、截圖模式、閒置自動巡遊 |
| 14 | 財富之種 | 資源庫存 + Event Bus、資源 HUD、出貨箱 |
| 15 | 智慧成長 | 歷史工作階段 NPC、雜貨店/商店、資源飛出動畫 |
| 16 | 無限地平線 | Chunk 無限地圖、動態光照 2.0、衝刺與體力系統 |
| 17 | 工業革命 | 加工建築（磨坊/工坊）、動態天氣系統、圓形小地圖 |

### 待辦（路線圖）

| 階段 | Sprint | 優先級 | 功能 | 說明 |
|------|--------|--------|------|------|
| 4 | 18+ | P1 | 科技樹升級 | 工具效率、自動澆水、自動收穫機器人 |
| 4 | 18+ | P2 | 釣魚系統 | 河流/湖泊生成、釣魚小遊戲 |
| 5 | TBD | P2 | 房屋自訂 | 玩家房屋內部裝潢系統 |
| 5 | TBD | P1 | AI 廣播板 | NPC 即時評論 git commit |
| 5 | TBD | P2 | 博物館與名人堂 | 展示所有工作階段統計與稀有收藏品 |
| 5 | TBD | P2 | 貿易與外交 | 跨專案資源交易模擬 |

## 快速開始

```bash
npm install
npm start
```

需要有進行中的 Claude Code 工作階段，寫入 JSONL 日誌到 `~/.claude/projects/`。

## 架構

```
claude-buddy/
  main.js              # Electron 主程序、工作階段監控、IPC
  preload.js           # 主程序與渲染程序的橋接
  farm/
    farm-config.js     # 常數：能量值、作物、動物、里程碑
    farm-state.js      # 農場狀態管理、成長邏輯、持久化
    achievement-manager.js  # 成就追蹤與解鎖邏輯
  renderer/
    iso-engine.js      # 瓷磚式渲染引擎、鏡頭、粒子
    iso-farm.js        # 農場佈局、實體、HUD、截圖、自動巡遊
    iso-entity-manager.js  # 實體生命週期（角色、動物、靜態物）
    iso-weather.js     # 季節、天氣粒子、日夜循環、動態天氣
    iso-lighting.js    # 動態光照系統（夜間燈光、光暈）
    iso-train.js       # 火車進出站動畫
    iso-effects.js     # 浮動文字、收穫獎勵、資源飛出動畫
    iso-tooltip.js     # 實體懸停提示
    iso-ui.js          # 模態覆蓋層（佈告欄）
    shop-ui.js         # 雜貨店商店模態
    event-bus.js       # 發布/訂閱事件系統
    resource-inventory.js  # 多資源庫存（WOOD、STONE、GOLD、作物）
    processing.js      # 加工建築系統（磨坊、工坊）
    minimap.js         # 圓形小地圖 HUD
    chunk-manager.js   # 無限地圖 Chunk 系統
    npc-manager.js     # 歷史工作階段 NPC 系統與進化等級
    player.js          # 玩家控制角色與物理
    buddy-ai.js        # 自主夥伴行為（農作、社交）
    farm.js            # 渲染端共享農場狀態
    sprite-manager.js  # PNG 精靈圖載入與程序化回退
    character.js       # 8 色帽 T 角色精靈圖
    scene.js           # 經典 2D 視角背景
    viewport.js        # 鏡頭視窗管理
    speech-bubble.js   # 聊天氣泡渲染
    state-machine.js   # 活動狀態機
    train.js           # 經典 2D 火車
    renderer.js        # 主渲染迴圈、輸入處理、視角管理
  watcher/
    data-exporter.js   # JSONL 匯出工具
  scripts/
    recolor_sprites.py # 精靈圖 HSV 色相偏移重新上色
```

## 技術棧

- **Electron** — 透明置頂桌面視窗
- **Canvas 2D** — 所有渲染皆為純 Canvas（無 WebGL、無框架）
- **Node.js** — JSONL 檔案監控、農場狀態持久化
- **Event Bus** — 資源、商店、NPC 系統的發布/訂閱解耦

## 開發團隊

- **Joe** — 決策者，串接所有 AI 協作者
- **Claude** — 主要開發者/執行者
- **Gemini CTO** — 架構決策與程式碼審查
- **Gemini PM** — 功能優先級與 Sprint 規劃

## 授權

MIT
